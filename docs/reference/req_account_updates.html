<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Request Account Updates — req_account_updates • InteractiveTradeR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cyborg/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>

<meta property="og:title" content="Request Account Updates — req_account_updates" />
<meta property="og:description" content="This function either fetches or sets up a subscription to receive the data
that appear in the
&quot;Account
Window&quot; window of Trader Workstation for the single account specified in the
**`acctCode`** input. Unlike req_account_updates_multi(),
`req_account_updates`() can only subscribe to one account at a time." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">InteractiveTradeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Socks.html">Socks</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JakeVestal/InteractiveTradeR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Request Account Updates</h1>
    <small class="dont-index">Source: <a href='https://github.com/JakeVestal/InteractiveTradeR/blob/master/R/req_account_updates.R'><code>R/req_account_updates.R</code></a></small>
    <div class="hidden name"><code>req_account_updates.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function either fetches or sets up a subscription to receive the data
that appear in the
"<a href='https://institutions.interactivebrokers.com/en/software/tws/usersguidebook/realtimeactivitymonitoring/the_account_window.htm'>Account
Window</a>" window of Trader Workstation for the single account specified in the
**`acctCode`** input. Unlike <a href='req_account_updates_multi.html'>req_account_updates_multi</a>(),
`req_account_updates`() can only subscribe to one account at a time.</p>
    </div>

    <pre class="usage"><span class='fu'>req_account_updates</span>(
  <span class='kw'>acctCode</span> <span class='kw'>=</span> <span class='st'>"All"</span>,
  <span class='kw'>subscribe</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>channel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>return_data</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span>(<span class='no'>channel</span>) <span class='kw'>&amp;&amp;</span> <span class='no'>subscribe</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>acctCode</th>
      <td><p>Character vector of length 1 containing the Account ID of the account for
which updates are sought. Possible choices include any one of the elements of
the output of <a href='req_managed_accts.html'>req_managed_accts</a>().</p></td>
    </tr>
    <tr>
      <th>subscribe</th>
      <td><p>Boolean. If TRUE, then a subscription is started and the socket passed in as
`channel` will continue to receive updated account info from Interactive
Brokers.</p></td>
    </tr>
    <tr>
      <th>channel</th>
      <td><p>One of the following:</p>
<ul>
<li><p><strong>Not Specified</strong> (Default): Opens a new connection to IB, uses
  it to issue the request and retrieve the response, and closes connection
  behind itself upon completion.</p></li>
<li><p><strong>The Name of a Sock</strong>: Character vector, length 1. The name of
  an open, connected socket in the <a href='socks.html'>sock_drawer</a>; e.g., "master", "tws",
  or "sock_123"</p></li>
<li><p><strong>Numeric Client ID</strong>: Numeric, length 1. The client ID for
  which open orders are to be retrieved; e.g., 0, 874, 123. If a client ID is
  passed, and no socket in the <a href='socks.html'>sock_drawer</a> is connected on that ID,
  then a new socket will be opened on that ID, and closed upon function exit.</p></li>
<li><p><strong>A <code>sockconn</code> Connection</strong>: An open connection object of
  class "sockconn", connected to the IB API; e.g., <code>sock_drawer$tws</code></p></li>
</ul></td>
    </tr>
    <tr>
      <th>return_data</th>
      <td><p>Boolean of length 1. Defaults to TRUE unless argument <em>channel</em> is
specified. If FALSE, data retrieved by the function will be returned as the
funciton's output. If TRUE, then a Boolean succeses flag will be returned as
the function's output indicating the success (TRUE) or failure (FALSE) of the
function's attempt to transceive data to/from IB. Data in the
<strong><code>treasury</code></strong> is always updated regardless of the value passed as
<em>return_data</em> in the function call.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>This function is called for its side effect of updating the
<strong><code>treasury</code></strong>, which takes place every time the function executes.
Additionally, the function's return value depends upon the value passed in as
<em>return_data</em> as follows:</p>
<ul>
<li><p><strong>If <code>return_data == FALSE</code></strong>: A Boolean success flag,
  returned invisibly, indicating that the function executed correctly and
  updated the <strong><code>treasury</code></strong> with any new data retrieved.</p></li>
<li><p><strong>If <code>return_data == TRUE</code></strong>: Any new data retrieved will
  be returned in a <a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a> in addition to being added to the
  <strong><code>treasury</code></strong>. If no new data is available, returns NULL.</p></li>
</ul>

<p><em>return_data</em> defaults to TRUE unless <em>channel</em> is specified.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>**Account Keys**: Several values of `param` in the `ACCOUNTS` element of
the output may or may not display suffixes; for example, the `param`
`AccruedDividend`. The meaning of these suffixes is as follows:
* "**-C**": Applies to commodities
* "**-S**": Applies to stocks
* **no suffix**: Values reported are totals</p>
<p>**"All" Option**: If you use a Financial Advisory (FA) account structure,
then you have the option of requesting account updates for all of the
sub-accounts that fall under the master account. To do this, append the
letter **"A"** to the end of the master account's ID and pass this value to
`req_account_updates`() as `acctCode`; for example, "F7654321A".</p>
<p>**No "`cancel_`" function, use `subscribe = FALSE`**: Unlike
<a href='req_account_summary.html'>req_account_summary</a>() and <a href='req_account_updates_multi.html'>req_account_updates_multi</a>(),
`req_account_updates`() does not have a companion function that cancels the
subscription. Instead, subscriptions are canceled on a socket by calling
`req_account_updates()` with `subscribe = FALSE`. See **Examples**.</p>
<p>**One account at a time / Overwriting subscriptions**: Even if you use
different sockets, IB's API protocol is set up in such a way that you may
only have one active `req_account_updates`() subscription running at any
given time. If you request another subscription, the new one will simply
overwrite the old one without an error message.</p>
<p>**Single Account**: If the user has access to only one account, then
supplying a value for `acctCode` is not necessary and may be left blank in
the function call.</p>
<p>**Time Zone**: Interactive Brokers' servers use a very simple hour:minute
formatted timestamp the response data reported by `req_account_updates`() in
the `acct_update_time` column of the output. The timestamp does not include a
time zone because it is understood that the times reported are denominated in
terms of the time zone set by clicking the "More Options" link in the login
window of either TWS or IBG.</p>
<p>**Cancelling subscriptions**: Use the command `req_account_updates`(subscribe
= FALSE). When cancelling a subscription made by `req_account_updates` in
InteractiveTradeR, any value passed in as `channel` is ignored, so it can be
left out entirely. This shortcut follows as consequence of the fact that IB
only allows one `req_account_updates`() subscription at a time.</p>
    <h2 class="hasAnchor" id="behavior"><a class="anchor" href="#behavior"></a>Behavior</h2>

    

<p>IB's documentation states that subscribed socket's account updates data will
be updated **every three (3) minutes** unless there is a position change, in
which case updates will be sent immediately.  However, during market hours,
you may observe much shorter, more frequent update intervals. You can explore
your actual observed update frequency by experimenting with Example 3 in the
"Examples" section below.</p>
    <h2 class="hasAnchor" id="accounts-and-portfolio-value-treasury-objects"><a class="anchor" href="#accounts-and-portfolio-value-treasury-objects"></a>ACCOUNTS and PORTFOLIO VALUE Treasury Objects</h2>

    

<p>`req_account_updates`() updates the **ACCOUNTS** and **PORTFOLIO VALUE**
objects in the treasury. Their structure is set forth as follows:</p>
<p>* **ACCOUNTS**: A <a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a> in which each row represents a
parameter pertaining to a particular account. Has the following columns:
  * **tag** &lt;chr&gt;: Name of account parameter, (e.g., "DayTradesRemaining")
  * **tag_value** &lt;chr&gt;: Value of the `param` (e.g., "3")
  * **currency** &lt;chr&gt;: 3-letter currency abbreviation if `tag_value` is a
  monetary amount, "" otherwise.
  * **account** &lt;chr&gt;: Account ID of the account to which the data applies.
  Included so that `ACCOUNTS` data returned for different accounts can be
  combined without losing track of which account applies to which data.</p>
<p>* **PORTFOLIO_VALUE**: A tibble in which every row represents an asset
held in an account. Has the following columns:
  * **account** &lt;chr&gt;: Account ID of the account to which the data applies.
  Included so that `PORTFOLIO_VALUE` data returned for different accounts can
  be combined without losing track of which account applies to which data.
  * **con_id** &lt;chr&gt;: Interactive Brokers' unique contract ID for the asset.
  * **symbol** &lt;chr&gt;: The exchange symbol under which the asset is traded,
  e.g., "FB", "AAPL", "IBM".
  * **sec_type** &lt;chr&gt;: Three-letter abbreviation for the class of the asset
  in the row, e.g., "STK", "CFD", "BOND", and so on.
  * **last_trade_date_or_contract_month** For options &amp; futures, the last
  trading day or contract month (as applicable), in YYYYMMDD ("\<!-- %Y\\%m\\%d" -->
  format in R) and YYYYMM ("\<!-- %Y\\%m" format in R) format, respectively. -->
  * **strike** &lt;numeric&gt;: Strike price of asset, if applicable.
  * **right** &lt;chr&gt;: If applicable, the "right" parameter of a contract, e.g.
  "C" (right to buy, for a call), "P" (right to sell, put).
  * **multiplier** &lt;dbl&gt;: The "lot size" of a contract, if applicable; e.g.,
  an options contract that affects 100 shares of underlying. Numeric.
  * **primary_exchange** &lt;chr&gt;: Main exchange on which a contract is traded,
  e.g., "NASDAQ", "NYSE".
  * **currency** &lt;chr&gt;: 3-letter abbreviation of the currency in which the
  contract is traded, e.g. "USD", "HKD".
  * **local_symbol** &lt;chr&gt;: The symbol under which the contract is traded in
  its primary exchange.
  * **trading_class** &lt;chr&gt;: Code that classifies an asset based on the
  manner in which it is traded. Stocks, for example, have `trading_class` =
  "NMS" denoting the United States'
  <a href='https://en.wikipedia.org/wiki/National_Market_System'>National Market
  System</a> for equities.
  * **position** &lt;dbl&gt;: Numeric, long or short. Denotes how many of the
  contracts are held. Don't forget about `multiplier`, if applicable!
  * **market_price** &lt;numeric&gt;: The market price of the contract on a
  per-contract basis as measured at time = `acct_update_time`.
  * **market_value** &lt;numeric&gt;: Market value of the acount's position in a
  particular contract; equal to `market_price * position`.
  * **average_cost** &lt;numeric&gt;: The effective price of the account's
  overall position in the asset, including transaction costs.
  * **unrealized_PNL** &lt;numeric&gt;: Equals `market_value -
  average_cost * position` and gives the profit or loss that would result if
  the position were closed at `market_price`. Does **not** take into account
  transction costs of closing the position.
  * **realized_PNL** &lt;numeric&gt;: Gives the real-world, historical profit or
  loss earned on positions that are now closed. Includes transaction costs.
* **If ASYNC mode** (*specified* `channel`)**:** Will return NULL invisibly
after writing to the socket as directed.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Clear out the treasury, sock drawer, and subscriptions</span>
<span class='fu'><a href='clean_slate.html'>clean_slate</a></span>()

<span class='co'>####</span>
<span class='co'>#### Example 1: Fetch account update for one account</span>
<span class='co'>####</span>

<span class='co'># Pick a random account for this example or specify one yourself,</span>
<span class='co'>#   e.g., acct &lt;- "DU1234567"</span>
<span class='no'>acct</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='req_managed_accts.html'>req_managed_accts</a></span>(), <span class='fl'>1</span>)
<span class='no'>acct</span></div><div class='output co'>#&gt; [1] "DU1267862"</div><div class='input'>
<span class='co'># Fetch account updates for the account, without starting a subscription</span>
<span class='fu'>req_account_updates</span>(<span class='no'>acct</span>)</div><div class='output co'>#&gt; $ACCOUNTS
#&gt; <span style='color: #949494;'># A tibble: 171 x 4</span><span>
#&gt;    account   tag                   tag_value  currency
#&gt;  </span><span style='color: #BCBCBC;'>*</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>                 </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> DU1267862 AccountType           INDIVIDUAL </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> DU1267862 AccountCode           DU1267862  </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> DU1267862 AccountReady          TRUE       </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> DU1267862 Cushion               0.998041   </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> DU1267862 DayTradesRemaining    -1         </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> DU1267862 DayTradesRemainingT+1 -1         </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> DU1267862 DayTradesRemainingT+2 -1         </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> DU1267862 DayTradesRemainingT+3 -1         </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> DU1267862 DayTradesRemainingT+4 -1         </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> DU1267862 Leverage-S            0.00       </span><span style='color: #949494;'>""</span><span>      
#&gt; </span><span style='color: #949494;'># … with 161 more rows</span><span>
#&gt; 
#&gt; $PORTFOLIO_VALUE
#&gt; </span><span style='color: #949494;'># A tibble: 3 x 14</span><span>
#&gt;   account con_id symbol sec_type primary_exchange currency local_symbol
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> DU1267… 14094  BMW    STK      IBIS             EUR      BMW         
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> DU1267… 43645… IBKR   STK      NASDAQ           USD      IBKR        
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> DU1267… 9408   MCD    STK      NYSE             USD      MCD         
#&gt; </span><span style='color: #949494;'># … with 7 more variables: trading_class </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, position </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   market_price </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, market_value </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, average_cost </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   unrealized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, realized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>
#&gt; </div><div class='input'>
<span class='co'># View the fetched data in a viewer tab</span>
<span class='fu'><a href='https://rdrr.io/r/utils/View.html'>View</a></span>(<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in View(treasury$ACCT_VALUE): invalid 'x' argument</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/View.html'>View</a></span>(<span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span>) <span class='co'># empty list if no positions</span></div><div class='output co'>#&gt; <span class='warning'>Warning: locale not supported by Xlib: some X ops will operate in C locale</span></div><div class='output co'>#&gt; <span class='warning'>Warning: X cannot set locale modifiers</span></div><div class='output co'>#&gt; <span class='warning'>Warning: unable to create fontset -*-fixed-medium-r-*-*-*-120-*-*-*-*-*-*</span></div><div class='output co'>#&gt; <span class='error'>Error in .External2(C_dataviewer, x, title): unable to start data viewer</span></div><div class='input'>
<span class='co'>####</span>
<span class='co'>#### Example 2: Fetch account update data for many accounts</span>
<span class='co'>####</span>

<span class='fu'><a href='clean_slate.html'>clean_slate</a></span>() <span class='co'># clean slate (optional)</span>

<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>      <span class='co'># should return NULL</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span> <span class='co'># should return NULL</span></div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='co'># Fetch account updates for all of your accounts using the walk() function</span>
<span class='co'># from the purrr package:</span>
<span class='fu'><a href='req_managed_accts.html'>req_managed_accts</a></span>() <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>purrr</span><span class='kw ns'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>walk</a></span>(
    <span class='kw'>function</span>(<span class='no'>account</span>){
      <span class='co'># Sys.sleep(1/50)</span>
      <span class='fu'>req_account_updates</span>(<span class='kw'>acctCode</span> <span class='kw'>=</span> <span class='no'>account</span>)
    }
  )</div><div class='output co'>#&gt; <span class='error'>Error in if (any(names(account_updates) == "PORTFOLIO_VALUE")) {    assign("PORTFOLIO_VALUE", value = structure(functionary$ib_update$PORTFOLIO_VALUE(account_updates$PORTFOLIO_VALUE),         last_updated = Sys.time()), envir = get("treasury"))}: missing value where TRUE/FALSE needed</span></div><div class='input'>
<span class='co'># This is equivalent to:</span>
<span class='kw'>for</span>(<span class='no'>account</span> <span class='kw'>in</span> <span class='fu'><a href='req_managed_accts.html'>req_managed_accts</a></span>()){
  <span class='co'># Sys.sleep(1/50)</span>
  <span class='fu'>req_account_updates</span>(<span class='kw'>acctCode</span> <span class='kw'>=</span> <span class='no'>account</span>)
}</div><div class='output co'>#&gt; <span class='error'>Error in if (any(names(account_updates) == "PORTFOLIO_VALUE")) {    assign("PORTFOLIO_VALUE", value = structure(functionary$ib_update$PORTFOLIO_VALUE(account_updates$PORTFOLIO_VALUE),         last_updated = Sys.time()), envir = get("treasury"))}: missing value where TRUE/FALSE needed</span></div><div class='input'>
<span class='co'># Uncomment the "Sys.sleep(1/50)" to pause execution for one fiftieth of a</span>
<span class='co'># second between each call to req_account_updates(). The reason you may want</span>
<span class='co'># to do this is that Interactive brokers only allows, at max, 50 API calls per</span>
<span class='co'># second. If you have more than 50 accounts and a fast computer &amp; connection,</span>
<span class='co'># the "Sys.sleep(1/50)" prevents you from exceeding the limit.</span>

<span class='co'># Check that all accounts are represented in ACCT_VALUE:</span>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(
  <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>$<span class='no'>account</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span>(<span class='fu'><a href='req_managed_accts.html'>req_managed_accts</a></span>())
)</div><div class='output co'>#&gt; [1] FALSE</div><div class='input'>
<span class='co'>####</span>
<span class='co'>#### Example 3: Persistent account update subscriptions</span>
<span class='co'>####</span>

<span class='co'># To create an ongoing subscription that continuously collects account</span>
<span class='co'># updates, make the same calls to req_account_updates() as above, but use a</span>
<span class='co'># persistent socket.</span>

<span class='fu'><a href='clean_slate.html'>clean_slate</a></span>() <span class='co'># clean slate, optional</span>

<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>      <span class='co'># should return NULL</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span> <span class='co'># should return NULL</span></div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='co'># Open up a socket</span>
<span class='fu'><a href='create_new_connections.html'>create_new_connections</a></span>(<span class='fl'>1</span>)

<span class='co'># Pick another random account, or replace the "sample()" with an account code</span>
<span class='co'># (e.g., "DU7654321") as desired</span>
<span class='no'>acct2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='req_managed_accts.html'>req_managed_accts</a></span>(), <span class='fl'>1</span>)

<span class='co'># Make the call, this time with channel = "async"</span>
<span class='fu'>req_account_updates</span>(<span class='no'>acct2</span>, <span class='kw'>channel</span> <span class='kw'>=</span> <span class='st'>"async"</span>)

<span class='co'># Within three minutes of starting the subscription, take a look at the</span>
<span class='co'># ACCT_VALUE and PORTFOLIO_VALUE objects in the treasury:</span>
<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span></div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 2 x 14</span><span>
#&gt;   account con_id symbol sec_type primary_exchange currency local_symbol
#&gt; </span><span style='color: #BCBCBC;'>*</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> DU1267… 43645… IBKR   STK      NASDAQ           USD      IBKR        
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> DU1267… 9408   MCD    STK      NYSE             USD      MCD         
#&gt; </span><span style='color: #949494;'># … with 7 more variables: trading_class </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, position </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   market_price </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, market_value </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, average_cost </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   unrealized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, realized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span></div><div class='input'><span class='co'># See when they were last updated:</span>
<span class='no'>acc_val_update_time</span>  <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span>(<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>,      <span class='st'>"last_updated"</span>)
<span class='no'>acc_val_update_time</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='no'>port_val_update_time</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span>(<span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span>, <span class='st'>"last_updated"</span>)
<span class='no'>port_val_update_time</span></div><div class='output co'>#&gt; [1] "2020-03-11 20:10:56 EDT"</div><div class='input'>
<span class='co'># Soon after creating the subscription, try to update the treasury objects by</span>
<span class='co'># calling read_sock_drawer():</span>
<span class='fu'><a href='read_sock_drawer.html'>read_sock_drawer</a></span>(<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; </span><span style='color: #BB0000;'>✖</span><span> No socks are ready to read.</div><div class='input'>
<span class='co'># If you're quick enough, you won't get any updated information because IB has</span>
<span class='co'># not sent updated data to the socket.</span>

<span class='co'># Keep calling...</span>
<span class='fu'><a href='read_sock_drawer.html'>read_sock_drawer</a></span>(<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; </span><span style='color: #BB0000;'>✖</span><span> No socks are ready to read.</div><div class='input'><span class='co'># ...a few times, waiting 10 or 20 seconds in between calls. After 3 minutes</span>
<span class='co'># have passed -- and probably before that -- you should see either or both of</span>
<span class='co'># the ACCT_VALUE and PORTFOLIO_VALUE objects update.</span>

<span class='co'># After updating, take a look in the treasury:</span>
<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span></div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 2 x 14</span><span>
#&gt;   account con_id symbol sec_type primary_exchange currency local_symbol
#&gt; </span><span style='color: #BCBCBC;'>*</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>       
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> DU1267… 43645… IBKR   STK      NASDAQ           USD      IBKR        
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> DU1267… 9408   MCD    STK      NYSE             USD      MCD         
#&gt; </span><span style='color: #949494;'># … with 7 more variables: trading_class </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, position </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   market_price </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, market_value </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, average_cost </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>,
#&gt; #   unrealized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span style='color: #949494;'>, realized_PNL </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span></div><div class='input'>
<span class='co'># And compare update times:</span>
<span class='no'>acc_val_update_time</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span>(<span class='no'>treasury</span>$<span class='no'>ACCT_VALUE</span>,<span class='st'>"last_updated"</span>)</div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='no'>port_val_update_time</span></div><div class='output co'>#&gt; [1] "2020-03-11 20:10:56 EDT"</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span>(<span class='no'>treasury</span>$<span class='no'>PORTFOLIO_VALUE</span>, <span class='st'>"last_updated"</span>)</div><div class='output co'>#&gt; [1] "2020-03-11 20:10:56 EDT"</div><div class='input'>
<span class='co'>#### Example 4: Cancelling Subscriptions</span>

<span class='co'># Cancel the subscription created in Example 3 with:</span>
<span class='fu'>req_account_updates</span>(<span class='no'>acct2</span>, <span class='kw'>subscribe</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#behavior">Behavior</a></li>
      <li><a href="#accounts-and-portfolio-value-treasury-objects">ACCOUNTS and PORTFOLIO VALUE Treasury Objects</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jake Vestal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


